name: Publish Library

on:
  push:
    branches:
      - main

jobs:
  build_and_publish:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up JDK
      uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '17'

    # Without the below command, system will get permission issues. This line was the only way
    # I could get the action to run successfully.
    - name: Change Mod gradlew
      run: chmod +x gradlew

    - name: Build and publish library
      env:
        # This needs to be set-up within github to be able to be run in the actions
        USERNAME: ${{ secrets.USERNAME }}
        # This is a token generated by Github that is good for 24 hours for the sole purpose of publishing.
        # See more details: https://docs.github.com/en/actions/security-guides/automatic-token-authentication
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
      run: |
        echo $USERNAME
        ./gradlew assembleRelease
        ./gradlew publish
